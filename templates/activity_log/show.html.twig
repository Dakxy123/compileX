{% extends 'base.html.twig' %}

{% block title %}Activity Log Details — Admin — CompileX{% endblock %}

{% block body %}
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = { darkMode: 'class' };
</script>

<div id="app" class="flex min-h-screen bg-slate-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100">

  {% include 'partials/_admin_sidebar.html.twig' with { active: 'activity_log' } only ignore missing %}

  <div class="flex-1 flex flex-col min-h-screen">
    {% include 'partials/_admin_header.html.twig' ignore missing %}

    <div class="h-16"></div>

    <main id="main-content" class="flex-1 p-8 max-w-3xl mx-auto space-y-6">
      <div class="flex items-center justify-between gap-3">
        <div>
          <h1 class="text-2xl font-semibold">Activity Log Details</h1>
          <p class="text-sm text-slate-500 dark:text-slate-400">
            Full information about this activity record.
          </p>
        </div>
        <div class="flex gap-2">
          <a href="{{ path('app_activity_log_edit', {id: activity_log.id}) }}"
             class="inline-flex items-center px-3 py-2 text-xs rounded-md border border-blue-500 text-blue-600 bg-white dark:bg-slate-900 hover:bg-blue-50 dark:hover:bg-slate-800">
            Edit
          </a>
          <a href="{{ path('app_activity_log_index') }}"
             class="inline-flex items-center px-3 py-2 text-xs rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 hover:bg-slate-100 dark:hover:bg-slate-800">
            ← Back to list
          </a>
        </div>
      </div>

      <div class="bg-white dark:bg-slate-900 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 p-5 space-y-4">
        <dl class="divide-y divide-slate-200 dark:divide-slate-700">
          <div class="py-3 grid grid-cols-3 gap-4">
            <dt class="text-xs font-medium text-slate-500 dark:text-slate-400">ID</dt>
            <dd class="col-span-2 text-sm">{{ activity_log.id }}</dd>
          </div>
          <div class="py-3 grid grid-cols-3 gap-4">
            <dt class="text-xs font-medium text-slate-500 dark:text-slate-400">User</dt>
            <dd class="col-span-2 text-sm">
              {% if activity_log.user %}
                {{ activity_log.user.email }}
              {% else %}
                <span class="text-slate-400">System / unknown</span>
              {% endif %}
            </dd>
          </div>
          <div class="py-3 grid grid-cols-3 gap-4">
            <dt class="text-xs font-medium text-slate-500 dark:text-slate-400">Action</dt>
            <dd class="col-span-2 text-sm">
              <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-slate-100 dark:bg-slate-800 text-[11px] text-slate-700 dark:text-slate-300">
                {{ activity_log.action }}
              </span>
            </dd>
          </div>
          <div class="py-3 grid grid-cols-3 gap-4">
            <dt class="text-xs font-medium text-slate-500 dark:text-slate-400">Context</dt>
            <dd class="col-span-2 text-sm">
              {{ activity_log.context ?: '—' }}
            </dd>
          </div>
          <div class="py-3 grid grid-cols-3 gap-4">
            <dt class="text-xs font-medium text-slate-500 dark:text-slate-400">Description</dt>
            <dd class="col-span-2 text-sm whitespace-pre-line">
              {{ activity_log.description ?: '—' }}
            </dd>
          </div>
          <div class="py-3 grid grid-cols-3 gap-4">
            <dt class="text-xs font-medium text-slate-500 dark:text-slate-400">IP Address</dt>
            <dd class="col-span-2 text-sm">
              {{ activity_log.ipAddress ?: '—' }}
            </dd>
          </div>
          <div class="py-3 grid grid-cols-3 gap-4">
            <dt class="text-xs font-medium text-slate-500 dark:text-slate-400">Created at</dt>
            <dd class="col-span-2 text-sm">
              {{ activity_log.createdAt ? activity_log.createdAt|date('Y-m-d H:i:s') : '—' }}
            </dd>
          </div>
        </dl>

        <div class="pt-4 border-t border-slate-200 dark:border-slate-700">
          {% include 'activity_log/_delete_form.html.twig' with { activity_log: activity_log } %}
        </div>
      </div>
    </main>
  </div>
</div>

<script>
// same JS as earlier
const sidebar = document.getElementById('sidebar');
const burgerIcon = document.getElementById('burger-icon');

if (sidebar && burgerIcon) {
  function toggleSidebar() {
    sidebar.classList.toggle('-translate-x-full');
    burgerIcon.innerHTML = sidebar.classList.contains('-translate-x-full') ? '&#9776;' : '&times;';
  }
  window.toggleSidebar = toggleSidebar;

  const DARK_KEY = 'compilex-dark-mode';
  const modeToggle = document.getElementById('mode-toggle');
  function loadInitialTheme() {
    const saved = localStorage.getItem(DARK_KEY);
    document.documentElement.classList.toggle('dark', saved === 'true');
  }
  if (modeToggle) {
    modeToggle.addEventListener('click', e => {
      e.stopPropagation();
      const isDark = document.documentElement.classList.contains('dark');
      document.documentElement.classList.toggle('dark', !isDark);
      localStorage.setItem(DARK_KEY, (!isDark).toString());
    });
  }
  loadInitialTheme();

  document.addEventListener('click', e => {
    if (!sidebar.contains(e.target) &&
        !e.target.closest('button[aria-label="Toggle menu"]') &&
        !sidebar.classList.contains('-translate-x-full')) {
      toggleSidebar();
    }
  });
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && !sidebar.classList.contains('-translate-x-full')) toggleSidebar();
  });
}
</script>
{% endblock %}
