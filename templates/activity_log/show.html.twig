{% extends 'base.html.twig' %}

{% block title %}Activity Log Details — CompileX{% endblock %}

{% block stylesheets %}
<style>
  .glass{background:rgba(30,41,59,.92);backdrop-filter:blur(10px)}
  .dark .glass{background:rgba(31,41,55,.88)}
  .sidebar{width:18rem}
  .sidebar-collapsed .sidebar{width:5.25rem}
  .sidebar-collapsed .nav-text{display:none}
  .sidebar-collapsed .brand-sub{display:none}
  .content{margin-left:18rem}
  .sidebar-collapsed .content{margin-left:5.25rem}
  @media (max-width: 767px){.content{margin-left:0}}
</style>
{% endblock %}

{% block body %}
<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={darkMode:'class'};</script>

{% set isAdmin = is_granted('ROLE_ADMIN') %}
{% set isInstructor = is_granted('ROLE_INSTRUCTOR') %}
{% set isStudent = is_granted('ROLE_USER') %}

{% set readableAction = activity_log.action
  |replace({
    '.created':' created',
    '.updated':' updated',
    '.deleted':' deleted',
    '_':' ',
    '.':' '
  })
  |title
%}

<div id="root" class="min-h-screen bg-slate-50 dark:bg-gray-900 text-slate-900 dark:text-gray-100">

  <header class="fixed top-0 left-0 right-0 z-40 glass border-b border-white/10">
    <div class="px-4 md:px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <button id="burger-mobile" class="md:hidden w-10 h-10 rounded-xl bg-white/10">&#9776;</button>
        <button id="burger-desktop" class="hidden md:inline-flex w-10 h-10 rounded-xl bg-white/10 items-center justify-center">≡</button>

        <div class="leading-tight">
          <div class="text-lg font-semibold text-blue-400">
            CompileX
            <span class="text-sm text-white/60">
              {% if isAdmin %}Admin{% elseif isInstructor %}Instructor{% else %}Student{% endif %}
            </span>
          </div>
          <div class="text-xs text-white/70 brand-sub">Activity Log Details</div>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <button id="mode-toggle" class="px-3 py-1.5 rounded-full bg-white/10 text-sm">Mode</button>
        <a href="{{ path('app_logout') }}" class="px-3 py-1.5 rounded-full bg-red-500/20 text-red-200 text-sm">Logout</a>
      </div>
    </div>
  </header>

  <div class="h-16"></div>

  <aside id="sidebar"
         class="sidebar fixed top-16 left-0 z-50 h-[calc(100vh-64px)] bg-slate-900 dark:bg-gray-900 border-r border-white/10 overflow-y-auto transform -translate-x-full md:translate-x-0 transition">
    <nav class="px-4 py-6 space-y-4 text-sm">

      <a href="{{ path('home') }}" class="flex gap-3 px-3 py-2 rounded-xl hover:bg-white/10">
        <span class="w-2.5 h-2.5 rounded-full bg-white/60"></span>
        <span class="nav-text">Home</span>
      </a>

      {% if isAdmin %}
        <a href="{{ path('app_admin') }}" class="flex gap-3 px-3 py-2 rounded-xl hover:bg-white/10">
          <span class="w-2.5 h-2.5 rounded-full bg-blue-300/80"></span>
          <span class="nav-text">Admin Dashboard</span>
        </a>

        <a href="{{ path('app_activity_log_index') }}"
           class="flex gap-3 px-3 py-2 rounded-xl bg-white/10 border border-white/10">
          <span class="w-2.5 h-2.5 rounded-full bg-pink-300/80"></span>
          <span class="nav-text">Activity Logs</span>
        </a>
      {% endif %}

      {% if isInstructor %}
        <a href="{{ path('app_instructor_dashboard') }}" class="flex gap-3 px-3 py-2 rounded-xl hover:bg-white/10">
          <span class="w-2.5 h-2.5 rounded-full bg-emerald-300/80"></span>
          <span class="nav-text">Instructor Dashboard</span>
        </a>
      {% endif %}

      {% if isStudent %}
        <a href="{{ path('app_student_dashboard') }}" class="flex gap-3 px-3 py-2 rounded-xl hover:bg-white/10">
          <span class="w-2.5 h-2.5 rounded-full bg-sky-300/80"></span>
          <span class="nav-text">Student Dashboard</span>
        </a>
      {% endif %}

    </nav>
  </aside>

  <main class="content px-4 md:px-8 py-8">
    <div class="max-w-4xl mx-auto space-y-6">

      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-semibold">Activity Log Details</h1>
          <p class="text-sm text-slate-600 dark:text-gray-400">
            Detailed system activity information
          </p>
        </div>

        <a href="{{ path('app_activity_log_index') }}"
           class="px-4 py-2 rounded-lg border border-slate-300 dark:border-gray-600 text-sm hover:bg-slate-50 dark:hover:bg-gray-800">
          ← Back to Logs
        </a>
      </div>

      <div class="bg-white dark:bg-gray-800 border border-slate-200 dark:border-gray-700 rounded-2xl shadow-sm p-6 space-y-6">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">

          <div>
            <p class="text-xs uppercase text-slate-500 dark:text-gray-400">Date & Time</p>
            <p class="font-semibold">
              {{ activity_log.createdAt ? activity_log.createdAt|date('Y-m-d H:i:s') : '—' }}
            </p>
          </div>

          <div>
            <p class="text-xs uppercase text-slate-500 dark:text-gray-400">User</p>
            <p class="font-semibold">
              {{ activity_log.user ? activity_log.user.email : 'System / Unknown' }}
            </p>
          </div>

          <div>
            <p class="text-xs uppercase text-slate-500 dark:text-gray-400">Action</p>
            <span class="inline-flex px-3 py-1 rounded-full text-xs font-semibold bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300">
              {{ readableAction }}
            </span>
          </div>

          <div>
            <p class="text-xs uppercase text-slate-500 dark:text-gray-400">Context</p>
            <p>{{ activity_log.context ?? '—' }}</p>
          </div>
        </div>

        <div>
          <p class="text-xs uppercase text-slate-500 dark:text-gray-400 mb-1">Description</p>
          <div class="bg-slate-50 dark:bg-gray-900 border border-slate-200 dark:border-gray-700 rounded-xl p-4 text-sm whitespace-pre-line">
            {{ activity_log.description ?? 'No description provided.' }}
          </div>
        </div>

      </div>
    </div>
  </main>
</div>

<script>
const DARK_KEY='compilex-dark-mode'
const SIDEBAR_KEY='compilex-sidebar-collapsed'

const sidebar=document.getElementById('sidebar')
const burgerMobile=document.getElementById('burger-mobile')
const burgerDesktop=document.getElementById('burger-desktop')
const root=document.getElementById('root')
const modeToggle=document.getElementById('mode-toggle')

function setTheme(v){
  document.documentElement.classList.toggle('dark',v)
  localStorage.setItem(DARK_KEY,v)
}
function loadTheme(){setTheme(localStorage.getItem(DARK_KEY)==='true')}

function toggleSidebar(){
  if(window.innerWidth<768){
    sidebar.classList.toggle('-translate-x-full')
  }else{
    root.classList.toggle('sidebar-collapsed')
    localStorage.setItem(SIDEBAR_KEY,root.classList.contains('sidebar-collapsed'))
  }
}

burgerMobile?.addEventListener('click',toggleSidebar)
burgerDesktop?.addEventListener('click',toggleSidebar)
modeToggle?.addEventListener('click',()=>setTheme(!document.documentElement.classList.contains('dark')))

loadTheme()
</script>
{% endblock %}
