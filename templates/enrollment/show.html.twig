{% extends 'base.html.twig' %}

{% block title %}Enrollment Details — CompileX{% endblock %}

{% block body %}
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = { darkMode: 'class' };
</script>

<div id="app" class="flex min-h-screen bg-slate-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100">
  <div class="flex-1 flex flex-col min-h-screen">

    <header class="fixed top-0 left-0 w-full z-40 bg-slate-800 text-white dark:bg-gray-800 flex items-center justify-between px-6 py-3 shadow-md">
      <h1 class="text-xl font-semibold text-blue-400 dark:text-blue-300 tracking-tight">
        CompileX — Enrollment
      </h1>
    </header>

    <div class="h-16"></div>

    <main class="flex-1 p-6 md:p-8 max-w-4xl mx-auto w-full space-y-6">

      <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
        <div>
          <h1 class="text-3xl font-semibold">Enrollment Details</h1>
          <p class="text-sm text-slate-600 dark:text-gray-400 mt-1">
            Detailed view of a student enrollment record.
          </p>
        </div>

        <div class="flex gap-2">
          <a href="{{ path('app_enrollment_index') }}"
             class="inline-flex items-center px-4 py-2 text-sm font-semibold rounded-xl border border-slate-300 dark:border-gray-600 bg-white dark:bg-gray-900 hover:bg-slate-50 dark:hover:bg-gray-800">
            ← Back
          </a>

          {% if is_granted('ROLE_ADMIN') %}
            <a href="{{ path('app_enrollment_edit', {'id': enrollment.id}) }}"
               class="inline-flex items-center px-4 py-2 text-sm font-semibold rounded-xl bg-yellow-500 text-white hover:bg-yellow-600 dark:hover:bg-yellow-700">
              Edit
            </a>
          {% endif %}
        </div>
      </div>

      {% set studentProfile = enrollment.studentProfile ?? null %}
      {% set studentUser    = studentProfile and studentProfile.user is defined ? studentProfile.user : null %}
      {% set subject        = enrollment.subject ?? null %}
      {% set course         = subject and subject.course is defined ? subject.course : null %}

      <div class="bg-white dark:bg-gray-800 border border-slate-200 dark:border-gray-700 rounded-xl shadow-sm p-6 space-y-6">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
          <div>
            <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-gray-400">Enrollment ID</p>
            <p class="font-semibold">{{ enrollment.id }}</p>
          </div>

          <div>
            <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-gray-400">Student</p>
            <p class="font-semibold">
              {{ studentUser and studentUser.email is defined ? studentUser.email : '—' }}
            </p>
          </div>

          <div>
            <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-gray-400">Course</p>
            <p class="font-semibold">
              {{ course and course.name is defined ? course.name : '—' }}
            </p>
          </div>

          <div>
            <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-gray-400">Subject</p>
            <p class="font-semibold">
              {{ subject and subject.name is defined ? subject.name : '—' }}
            </p>
          </div>

          <div>
            <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-gray-400">Status</p>
            {% set st = enrollment.status ?? '—' %}
            {% set badge = {
              'Approved': 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300',
              'Pending':  'bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300',
              'Rejected': 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300'
            }[st] ?? 'bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300' %}

            <span class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full {{ badge }}">
              {{ st }}
            </span>
          </div>

          {% if enrollment.score is defined %}
            <div>
              <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-gray-400">Score</p>
              <p class="font-semibold">{{ enrollment.score ?? '—' }}</p>
            </div>
          {% endif %}

          {% if enrollment.grade is defined %}
            <div>
              <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-gray-400">Grade</p>
              <p class="font-semibold">{{ enrollment.grade ?? '—' }}</p>
            </div>
          {% endif %}
        </div>

        {% if enrollment.remarks is defined and enrollment.remarks %}
          <div>
            <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-gray-400 mb-1">
              Remarks
            </p>
            <div class="bg-slate-50 dark:bg-gray-900 border border-slate-200 dark:border-gray-700 rounded-lg p-4 text-sm">
              {{ enrollment.remarks }}
            </div>
          </div>
        {% endif %}

        {% if enrollment.createdAt is defined or enrollment.updatedAt is defined %}
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm pt-4 border-t border-slate-200 dark:border-gray-700">
            {% if enrollment.createdAt is defined %}
              <div>
                <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-gray-400">Created At</p>
                <p class="font-semibold">{{ enrollment.createdAt|date('Y-m-d H:i') }}</p>
              </div>
            {% endif %}
            {% if enrollment.updatedAt is defined %}
              <div>
                <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-gray-400">Updated At</p>
                <p class="font-semibold">{{ enrollment.updatedAt|date('Y-m-d H:i') }}</p>
              </div>
            {% endif %}
          </div>
        {% endif %}

        {% if is_granted('ROLE_ADMIN') %}
          <div class="pt-4 border-t border-slate-200 dark:border-gray-700 flex justify-end">
            {% include 'enrollment/_delete_form.html.twig' %}
          </div>
        {% endif %}

      </div>

    </main>
  </div>
</div>
{% endblock %}
