{% extends 'base.html.twig' %}

{% block title %}CompileX{% endblock %}

{% block stylesheets %}
<style>
  html { scroll-behavior: smooth; }
  .sidebar { transform: translateX(-100%); transition: transform .25s ease-in-out; }
  .sidebar.active { transform: translateX(0); }
  main { padding-top: 64px; }

  .hero-bg {
    background-image: radial-gradient(1200px 600px at 20% 10%, rgba(59,130,246,.25), transparent 60%),
                      radial-gradient(900px 500px at 90% 20%, rgba(99,102,241,.18), transparent 55%),
                      linear-gradient(rgba(30,41,59,0.88), rgba(30,41,59,0.62)),
                      url("img/hero-placeholder.png");
    background-size: cover;
    background-position: center;
  }

  .fade-x {
    -webkit-mask-image: linear-gradient(to right, transparent, black 9%, black 91%, transparent);
            mask-image: linear-gradient(to right, transparent, black 9%, black 91%, transparent);
  }

  #course-carousel::-webkit-scrollbar { height: 10px; }
  #course-carousel::-webkit-scrollbar-track { background: transparent; }
  #course-carousel::-webkit-scrollbar-thumb { background: rgba(148,163,184,.65); border-radius: 999px; }
  .dark #course-carousel::-webkit-scrollbar-thumb { background: rgba(71,85,105,.8); }

  .glow-ring:focus { outline: none; box-shadow: 0 0 0 3px rgba(59,130,246,.35); }
</style>
{% endblock %}

{% block body %}
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = { darkMode: 'class' };
</script>

<body class="antialiased bg-slate-50 text-slate-800 dark:bg-gray-900 dark:text-gray-100">

  <header class="fixed top-0 left-0 w-full z-50 bg-slate-800/95 backdrop-blur text-white dark:bg-gray-800/90 px-4 py-3 flex items-center justify-between border-b border-white/5">
    <div class="flex items-center gap-3">
      <div class="w-9 h-9 rounded-xl bg-white/10 border border-white/10 flex items-center justify-center">
        <span class="text-blue-300 font-black">C</span>
      </div>
      <h1 class="text-xl font-semibold text-blue-400 dark:text-blue-300 font-sans tracking-tight">CompileX</h1>
    </div>

    <div class="flex items-center gap-3">
      <nav class="hidden md:flex gap-1 bg-white/5 border border-white/10 rounded-full px-2 py-1">
        <a href="#hero" class="px-3 py-1.5 rounded-full text-slate-200 hover:text-white hover:bg-white/10 transition">Home</a>
        <a href="#about" class="px-3 py-1.5 rounded-full text-slate-200 hover:text-white hover:bg-white/10 transition">About</a>
        <a href="#courses" class="px-3 py-1.5 rounded-full text-slate-200 hover:text-white hover:bg-white/10 transition">Courses</a>
        <a href="#team" class="px-3 py-1.5 rounded-full text-slate-200 hover:text-white hover:bg-white/10 transition">Team</a>
        <a href="#contact" class="px-3 py-1.5 rounded-full text-slate-200 hover:text-white hover:bg-white/10 transition">Contact</a>
      </nav>

      <button id="mode-toggle"
              class="hidden md:inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-slate-100 text-sm glow-ring">
        <span class="opacity-90">Mode</span>
      </button>

      <div class="hidden md:flex gap-2">
        {% if app.user %}
          {% if is_granted('ROLE_ADMIN') %}
            <a href="{{ path('app_admin') }}"
               class="px-3 py-1.5 rounded-full border border-slate-200 bg-white hover:bg-slate-50 text-slate-800 text-sm glow-ring">
              Admin
            </a>
          {% elseif is_granted('ROLE_INSTRUCTOR') %}
            <a href="{{ path('app_instructor_dashboard') }}"
               class="px-3 py-1.5 rounded-full border border-slate-200 bg-white hover:bg-slate-50 text-slate-800 text-sm glow-ring">
              Instructor
            </a>
          {% else %}
            <a href="{{ path('app_student_dashboard') }}"
               class="px-3 py-1.5 rounded-full border border-slate-200 bg-white hover:bg-slate-50 text-slate-800 text-sm glow-ring">
              Student
            </a>
          {% endif %}

          <a href="{{ path('app_logout') }}"
             class="px-3 py-1.5 rounded-full bg-slate-100 hover:bg-slate-200 text-slate-800 text-sm glow-ring">
            Logout
          </a>
        {% else %}
          <a href="{{ path('app_register_student') }}"
             class="px-3 py-1.5 rounded-full border border-blue-400/70 bg-transparent hover:bg-blue-500/10 text-blue-200 text-sm glow-ring">
            Sign up
          </a>

          <a href="{{ path('app_login') }}"
             class="px-3 py-1.5 rounded-full bg-blue-500 hover:bg-blue-600 text-white text-sm glow-ring">
            Login
          </a>
        {% endif %}
      </div>

      <button class="md:hidden text-2xl focus:outline-none glow-ring" aria-label="Open menu" onclick="openSidebar()">&#9776;</button>
    </div>
  </header>

  <aside id="sidebar"
         class="sidebar fixed top-0 left-0 h-full w-72 bg-slate-900 text-white dark:bg-gray-900 p-6 z-50 md:hidden border-r border-white/10">
    <div class="flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl bg-white/10 border border-white/10 flex items-center justify-center">
          <span class="text-blue-300 font-black">C</span>
        </div>
        <h2 class="text-xl font-semibold tracking-tight">CompileX</h2>
      </div>
      <button class="text-white text-2xl focus:outline-none glow-ring" onclick="closeSidebar()">×</button>
    </div>

    <nav class="mt-8 flex flex-col gap-2">
      <a href="#hero" onclick="closeSidebar()" class="px-3 py-2 rounded-xl text-slate-200 hover:text-white hover:bg-white/10 transition">Home</a>
      <a href="#about" onclick="closeSidebar()" class="px-3 py-2 rounded-xl text-slate-200 hover:text-white hover:bg-white/10 transition">About</a>
      <a href="#courses" onclick="closeSidebar()" class="px-3 py-2 rounded-xl text-slate-200 hover:text-white hover:bg-white/10 transition">Courses</a>
      <a href="#team" onclick="closeSidebar()" class="px-3 py-2 rounded-xl text-slate-200 hover:text-white hover:bg-white/10 transition">Team</a>
      <a href="#contact" onclick="closeSidebar()" class="px-3 py-2 rounded-xl text-slate-200 hover:text-white hover:bg-white/10 transition">Contact</a>
    </nav>

    <div class="pt-6 mt-6 border-t border-white/10 space-y-2">
      <button id="mode-toggle-mobile"
              class="w-full px-3 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 text-slate-100 text-sm glow-ring">
        Toggle Mode
      </button>

      {% if app.user %}
        {% if is_granted('ROLE_ADMIN') %}
          <a href="{{ path('app_admin') }}"
             onclick="closeSidebar()"
             class="w-full px-3 py-2 rounded-xl border border-slate-200 bg-white hover:bg-slate-50 block text-center text-slate-800 glow-ring">
            Admin
          </a>
        {% elseif is_granted('ROLE_INSTRUCTOR') %}
          <a href="{{ path('app_instructor_dashboard') }}"
             onclick="closeSidebar()"
             class="w-full px-3 py-2 rounded-xl border border-slate-200 bg-white hover:bg-slate-50 block text-center text-slate-800 glow-ring">
            Instructor
          </a>
        {% else %}
          <a href="{{ path('app_student_dashboard') }}"
             onclick="closeSidebar()"
             class="w-full px-3 py-2 rounded-xl border border-slate-200 bg-white hover:bg-slate-50 block text-center text-slate-800 glow-ring">
            Student Dashboard
          </a>
        {% endif %}

        <a href="{{ path('app_logout') }}"
           onclick="closeSidebar()"
           class="w-full px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 block text-center text-slate-800 glow-ring">
          Logout
        </a>
      {% else %}
        <a href="{{ path('app_register_student') }}"
           onclick="closeSidebar()"
           class="w-full px-3 py-2 rounded-xl border border-blue-400/70 bg-transparent hover:bg-blue-500/10 text-blue-200 block text-center glow-ring">
          Sign up
        </a>

        <a href="{{ path('app_login') }}"
           onclick="closeSidebar()"
           class="w-full px-3 py-2 rounded-xl bg-blue-500 hover:bg-blue-600 text-white block text-center glow-ring">
          Login
        </a>
      {% endif %}
    </div>
  </aside>

  <main>
    <section id="hero" class="hero-bg h-[64vh] min-h-[460px] flex flex-col items-center justify-center text-center text-white px-4">
      <div class="max-w-3xl">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-xs mb-5">
          <span class="w-2 h-2 rounded-full bg-emerald-300"></span>
          <span class="text-slate-100/90">Modern learning platform</span>
        </div>

        <h2 class="text-3xl md:text-6xl font-extrabold mb-4 tracking-tight">
          Unlocking the Future of Learning
        </h2>

        <p class="max-w-2xl mx-auto mb-7 text-slate-100/90">
          Compile Knowledge, Build Skills — A modern, tech-inspired platform for students and instructors.
        </p>

        {% if app.user %}
          {% if is_granted('ROLE_ADMIN') %}
            <a href="{{ path('app_admin') }}"
               class="inline-flex items-center justify-center px-7 py-3 rounded-xl bg-blue-500 hover:bg-blue-600 transition focus:outline-none focus:ring-2 focus:ring-blue-300 glow-ring">
              Go to Admin Dashboard
            </a>
          {% elseif is_granted('ROLE_INSTRUCTOR') %}
            <a href="{{ path('app_instructor_dashboard') }}"
               class="inline-flex items-center justify-center px-7 py-3 rounded-xl bg-blue-500 hover:bg-blue-600 transition focus:outline-none focus:ring-2 focus:ring-blue-300 glow-ring">
              Go to Instructor Dashboard
            </a>
          {% else %}
            <a href="{{ path('app_student_dashboard') }}"
               class="inline-flex items-center justify-center px-7 py-3 rounded-xl bg-blue-500 hover:bg-blue-600 transition focus:outline-none focus:ring-2 focus:ring-blue-300 glow-ring">
              Go to Student Dashboard
            </a>
          {% endif %}
        {% else %}
          <a href="{{ path('app_register_student') }}"
             class="inline-flex items-center justify-center px-7 py-3 rounded-xl bg-blue-500 hover:bg-blue-600 transition focus:outline-none focus:ring-2 focus:ring-blue-300 glow-ring">
            Get Started — Sign up
          </a>
        {% endif %}
      </div>
    </section>

    <section id="about" class="py-16 px-4 bg-slate-50 dark:bg-gray-900 text-center">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-2xl font-bold mb-3 tracking-tight">About Us</h2>
        <p class="text-slate-600 dark:text-gray-300">
          CompileX empowers students and instructors with a modern, tech-inspired learning platform.
        </p>
      </div>
    </section>

    <section id="courses" class="py-16 px-4 bg-slate-50 dark:bg-gray-900">
      <div class="max-w-6xl mx-auto">
        <div class="text-center mb-8">
          <h2 class="text-2xl font-bold tracking-tight">Available Courses</h2>
          <p class="text-sm text-slate-500 dark:text-gray-400 mt-1">Swipe/scroll to view course names</p>
        </div>

        {% set courseNames = courses is defined ? courses : [] %}

        <div class="relative">
          <button type="button"
                  class="hidden md:flex items-center justify-center absolute left-0 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white/90 dark:bg-gray-800/90 border border-slate-200 dark:border-gray-700 shadow hover:scale-[1.05] transition glow-ring"
                  onclick="scrollCourses(-1)"
                  aria-label="Scroll left">
            ‹
          </button>

          <div id="course-carousel"
               class="fade-x flex gap-4 overflow-x-auto scroll-smooth snap-x snap-mandatory pb-4 px-14"
               style="-webkit-overflow-scrolling: touch;">
            {% for c in courseNames %}
              {% set name = c.name ?? c['name'] ?? c %}
              <div class="snap-start shrink-0">
                <div class="px-6 py-5 rounded-2xl bg-white/90 dark:bg-gray-800/90 border border-slate-200 dark:border-gray-700 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition min-w-[280px]">
                  <div class="text-center select-none text-lg md:text-xl font-semibold tracking-tight leading-tight"
                       data-course-name="1">
                    {{ name }}
                  </div>
                  <div class="mt-3 flex justify-center">
                    <span class="text-xs px-2.5 py-1 rounded-full bg-slate-100 dark:bg-gray-700 text-slate-600 dark:text-gray-200 border border-slate-200/70 dark:border-gray-600/70">
                      Active
                    </span>
                  </div>
                </div>
              </div>
            {% else %}
              <div class="w-full">
                <div class="px-4 py-3 rounded-xl bg-white dark:bg-gray-800 border border-slate-200 dark:border-gray-700 text-slate-500 dark:text-gray-400 text-sm text-center">
                  No courses available yet.
                </div>
              </div>
            {% endfor %}
          </div>

          <button type="button"
                  class="hidden md:flex items-center justify-center absolute right-0 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white/90 dark:bg-gray-800/90 border border-slate-200 dark:border-gray-700 shadow hover:scale-[1.05] transition glow-ring"
                  onclick="scrollCourses(1)"
                  aria-label="Scroll right">
            ›
          </button>
        </div>

        {% if app.user and is_granted('ROLE_ADMIN') %}
          <div class="mt-6 text-center">
            <a href="{{ path('app_course_index') }}"
               class="inline-flex items-center gap-2 px-5 py-2.5 rounded-xl bg-slate-800 dark:bg-gray-800 text-white hover:bg-slate-900 dark:hover:bg-gray-700 text-sm shadow-sm glow-ring">
              Manage Courses →
            </a>
          </div>
        {% endif %}
      </div>
    </section>

    <section id="team" class="py-16 px-4 bg-slate-50 dark:bg-gray-900">
      <div class="max-w-6xl mx-auto">
        <div class="text-center mb-8">
          <h2 class="text-2xl font-bold tracking-tight">Our Team</h2>
          <p class="text-sm text-slate-500 dark:text-gray-400 mt-1">Current instructors</p>
        </div>

        {% set teamList = instructors is defined ? instructors : [] %}

        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
          {% for instr in teamList %}
            {% set displayName = instr.email ?? instr['email'] ?? 'Instructor' %}
            <div class="bg-white/90 dark:bg-gray-800/90 rounded-2xl border border-slate-200 dark:border-gray-700 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition p-5 flex items-center gap-4">
              <div class="w-12 h-12 rounded-full bg-slate-100 dark:bg-gray-700 border border-slate-200 dark:border-gray-600 flex items-center justify-center text-slate-700 dark:text-gray-200 font-semibold">
                {{ displayName|slice(0,1)|upper }}
              </div>
              <div class="min-w-0 text-left">
                <div class="truncate font-semibold text-base leading-tight" data-team-name="1">
                  {{ displayName }}
                </div>
                <div class="mt-1 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-indigo-100 text-indigo-700 dark:bg-indigo-900/40 dark:text-indigo-200">
                  Instructor
                </div>
              </div>
            </div>
          {% else %}
            <div class="md:col-span-3">
              <div class="px-4 py-4 rounded-xl bg-white dark:bg-gray-800 border border-slate-200 dark:border-gray-700 text-slate-500 dark:text-gray-400 text-sm text-center">
                No instructors available yet.
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </section>

    <section id="contact" class="py-16 px-4 bg-slate-50 dark:bg-gray-900">
      <div class="max-w-2xl mx-auto text-center">
        <h2 class="text-2xl font-bold mb-4 tracking-tight">Contact Us</h2>

        {% for label, messages in app.flashes %}
          {% for message in messages %}
            <div class="mb-4 text-sm px-4 py-2 rounded-xl border
                        {% if label == 'success' %}
                          bg-green-50 text-green-800 border-green-200
                        {% else %}
                          bg-red-50 text-red-800 border-red-200
                        {% endif %}">
              {{ message }}
            </div>
          {% endfor %}
        {% endfor %}

        <form class="mx-auto" style="max-width:520px;"
              method="post"
              action="{{ path('app_contact_submit') }}">

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
            <input type="text"
                   name="name"
                   class="w-full px-4 py-2 border border-slate-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-200 dark:bg-gray-800"
                   placeholder="Your Name">
            <input type="email"
                   name="email"
                   class="w-full px-4 py-2 border border-slate-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-200 dark:bg-gray-800"
                   placeholder="Your Email">
          </div>

          <input type="text"
                 name="subject"
                 class="w-full px-4 py-2 mb-3 border border-slate-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-200 dark:bg-gray-800"
                 placeholder="Subject (optional)">

          <textarea
                 name="message"
                 class="w-full px-4 py-2 mb-3 border border-slate-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-200 dark:bg-gray-800"
                 rows="5"
                 placeholder="Your Message"></textarea>

          <button type="submit"
                  class="w-full sm:w-auto px-6 py-2.5 rounded-xl bg-blue-500 hover:bg-blue-600 transition text-white focus:outline-none focus:ring-2 focus:ring-blue-300 glow-ring shadow-sm">
            Send
          </button>
        </form>
      </div>
    </section>

    <footer class="bg-slate-900 dark:bg-gray-900 text-white py-8 mt-10 border-t border-white/10">
      <div class="max-w-6xl mx-auto text-center px-4">
        <p class="mb-3 text-white/80">&copy; <span id="year">2025</span> CompileX. All Rights Reserved.</p>
        <div class="flex flex-wrap justify-center gap-4 text-slate-300">
          <a href="#" class="hover:text-white transition">Terms of Service</a>
          <a href="#" class="hover:text-white transition">Privacy Policy</a>
          <a href="#contact" class="hover:text-white transition">Contact</a>
        </div>
      </div>
    </footer>

  </main>

  <script>
    function openSidebar(){ document.getElementById("sidebar").classList.add("active"); }
    function closeSidebar(){ document.getElementById("sidebar").classList.remove("active"); }

    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape'){ closeSidebar(); }
    });

    document.querySelectorAll('#sidebar nav a').forEach(a => {
      a.addEventListener('click', () => closeSidebar());
    });

    function scrollCourses(dir){
      const el = document.getElementById('course-carousel');
      if (!el) return;
      const amount = Math.max(300, Math.floor(el.clientWidth * 0.7));
      el.scrollBy({ left: dir * amount, behavior: 'smooth' });
    }

    const DARK_KEY = 'compilex-dark-mode';

    function setTheme(isDark){
      document.documentElement.classList.toggle('dark', !!isDark);
      localStorage.setItem(DARK_KEY, (!!isDark).toString());
      applyNameStyles();
    }

    function loadInitialTheme(){
      const saved = localStorage.getItem(DARK_KEY);
      setTheme(saved === 'true');
    }

    function randInt(min, max){
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function styleEl(el, i, isDark){
      const fonts = ['font-sans','font-serif','font-mono'];
      el.classList.remove('font-sans','font-serif','font-mono');
      el.classList.add(fonts[(i + randInt(0, 20)) % fonts.length]);
      const hue = (i * 47 + randInt(0, 360)) % 360;
      const sat = 70;
      const lightness = isDark ? 72 : 32;
      el.style.color = `hsl(${hue} ${sat}% ${lightness}%)`;
    }

    function applyNameStyles(){
      const isDark = document.documentElement.classList.contains('dark');

      document.querySelectorAll('[data-course-name]').forEach((el, i) => {
        styleEl(el, i, isDark);
      });

      document.querySelectorAll('[data-team-name]').forEach((el, i) => {
        styleEl(el, i + 100, isDark);
      });
    }

    const modeToggle = document.getElementById('mode-toggle');
    const modeToggleMobile = document.getElementById('mode-toggle-mobile');

    if (modeToggle) {
      modeToggle.addEventListener('click', () => {
        const isDark = document.documentElement.classList.contains('dark');
        setTheme(!isDark);
      });
    }

    if (modeToggleMobile) {
      modeToggleMobile.addEventListener('click', (e) => {
        e.stopPropagation();
        const isDark = document.documentElement.classList.contains('dark');
        setTheme(!isDark);
      });
    }

    const yearEl = document.getElementById('year');
    if (yearEl) yearEl.textContent = String(new Date().getFullYear());

    loadInitialTheme();
    applyNameStyles();
  </script>

</body>
{% endblock %}
